{"ast":null,"code":"import _toConsumableArray from\"C:\\\\Users\\\\Usuario\\\\reactProjects\\\\findYourHouse\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _classCallCheck from\"C:\\\\Users\\\\Usuario\\\\reactProjects\\\\findYourHouse\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _inherits from\"C:\\\\Users\\\\Usuario\\\\reactProjects\\\\findYourHouse\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Usuario\\\\reactProjects\\\\findYourHouse\\\\app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from'react';import{ActionCable}from'react-actioncable-provider';import NewConversationForm from'./NewConversationForm';import MessagemsArea from'./MessagemsArea';import Cable from'./Cable';var ConversationsList=/*#__PURE__*/function(_React$Component){_inherits(ConversationsList,_React$Component);var _super=_createSuper(ConversationsList);function ConversationsList(){var _this;_classCallCheck(this,ConversationsList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={conversations:[],activeConversation:null};_this.componentDidMount=function(){var token=localStorage.getItem('token');console.log(_this.state);fetch(\"https://aqueous-wildwood-18424.herokuapp.com/conversations\",{method:'GET',headers:{\"Content-Type\":\"application/json\",\"Authorization\":\"Bearer \".concat(token),Accept:'application/json'}}).then(function(res){return res.json();}).then(function(conversations){return _this.setState({conversations:conversations});});};_this.handleClick=function(id){_this.setState({activeConversation:id});};_this.handleReceivedConversation=function(response){var conversation=response.conversation;_this.setState({conversations:[].concat(_toConsumableArray(_this.state.conversations),[conversation])});};_this.handleReceivedMessagem=function(response){var messagem=response.messagem;var conversations=_toConsumableArray(_this.state.conversations);var conversation=conversations.find(function(conversation){return conversation.id===messagem.conversation_id;});conversation.messagems=[].concat(_toConsumableArray(conversation.messagems),[messagem]);_this.setState({conversations:conversations});};_this.render=function(){var _this$state=_this.state,conversations=_this$state.conversations,activeConversation=_this$state.activeConversation;return/*#__PURE__*/React.createElement(\"div\",{className:\"conversationsList\"},/*#__PURE__*/React.createElement(ActionCable,{channel:{channel:'ConversationsChannel'},onReceived:_this.handleReceivedConversation}),_this.state.conversations.length?/*#__PURE__*/React.createElement(Cable,{conversations:conversations,handleReceivedMessagem:_this.handleReceivedMessagem}):null,/*#__PURE__*/React.createElement(\"h2\",null,\"Conversations\"),/*#__PURE__*/React.createElement(\"ul\",null,mapConversations(conversations,_this.handleClick)),/*#__PURE__*/React.createElement(NewConversationForm,null),activeConversation?/*#__PURE__*/React.createElement(MessagemsArea,{conversation:findActiveConversation(conversations,activeConversation)}):null);};return _this;}return ConversationsList;}(React.Component);export default ConversationsList;// helpers\nvar findActiveConversation=function findActiveConversation(conversations,activeConversation){return conversations.find(function(conversation){return conversation.id===activeConversation;});};var mapConversations=function mapConversations(conversations,handleClick){console.log(conversations);return conversations.map(function(conversation){return/*#__PURE__*/React.createElement(\"li\",{key:conversation.id,onClick:function onClick(){return handleClick(conversation.id);}},conversation.title);});};","map":{"version":3,"sources":["C:/Users/Usuario/reactProjects/findYourHouse/app/src/components/ConversationsList.js"],"names":["React","ActionCable","NewConversationForm","MessagemsArea","Cable","ConversationsList","state","conversations","activeConversation","componentDidMount","token","localStorage","getItem","console","log","fetch","method","headers","Accept","then","res","json","setState","handleClick","id","handleReceivedConversation","response","conversation","handleReceivedMessagem","messagem","find","conversation_id","messagems","render","channel","length","mapConversations","findActiveConversation","Component","map","title"],"mappings":"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","sourcesContent":["\r\nimport React from 'react';\r\nimport { ActionCable } from 'react-actioncable-provider';\r\nimport NewConversationForm from './NewConversationForm';\r\nimport MessagemsArea from './MessagemsArea';\r\nimport Cable from './Cable';\r\n\r\nclass ConversationsList extends React.Component {\r\n  state = {\r\n    conversations: [],\r\n    activeConversation: null\r\n  };\r\n\r\n  componentDidMount = () => {\r\n    const token = localStorage.getItem('token');\r\n    console.log(this.state)\r\n\r\n    fetch(`https://aqueous-wildwood-18424.herokuapp.com/conversations`, {\r\n      method: 'GET',\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n        \"Authorization\": `Bearer ${token}`,\r\n        Accept: 'application/json',\r\n      }\r\n    })\r\n      .then(res => res.json())\r\n      .then(conversations => this.setState({ conversations }));\r\n  };\r\n\r\n  handleClick = id => {\r\n    this.setState({ activeConversation: id });\r\n  };\r\n\r\n  handleReceivedConversation = response => {\r\n    const { conversation } = response;\r\n    this.setState({\r\n      conversations: [...this.state.conversations, conversation]\r\n    });\r\n  };\r\n\r\n  handleReceivedMessagem = response => {\r\n    const { messagem } = response;\r\n    const conversations = [...this.state.conversations];\r\n    const conversation = conversations.find(\r\n      conversation => conversation.id === messagem.conversation_id\r\n    );\r\n    conversation.messagems = [...conversation.messagems, messagem];\r\n    this.setState({ conversations });\r\n  };\r\n\r\n  render = () => {\r\n    const { conversations, activeConversation } = this.state;\r\n    return (\r\n      <div className=\"conversationsList\">\r\n        <ActionCable\r\n          channel={{ channel: 'ConversationsChannel' }}\r\n          onReceived={this.handleReceivedConversation}\r\n        />\r\n        {this.state.conversations.length ? (\r\n          <Cable\r\n            conversations={conversations}\r\n            handleReceivedMessagem={this.handleReceivedMessagem}\r\n          />\r\n        ) : null}\r\n        <h2>Conversations</h2>\r\n        <ul>{mapConversations(conversations, this.handleClick)}</ul>\r\n        <NewConversationForm />\r\n        {activeConversation ? (\r\n          <MessagemsArea\r\n            conversation={findActiveConversation(\r\n              conversations,\r\n              activeConversation\r\n            )}\r\n          />\r\n        ) : null}\r\n      </div>\r\n    );\r\n  };\r\n}\r\n\r\nexport default ConversationsList;\r\n\r\n// helpers\r\n\r\nconst findActiveConversation = (conversations, activeConversation) => {\r\n  return conversations.find(\r\n    conversation => conversation.id === activeConversation\r\n  );\r\n};\r\n\r\nconst mapConversations = (conversations, handleClick) => {\r\n  console.log(conversations)\r\n  return conversations.map(conversation => {\r\n    return (\r\n      <li key={conversation.id} onClick={() => handleClick(conversation.id)}>\r\n        {conversation.title}\r\n      </li>\r\n    );\r\n  });\r\n};"]},"metadata":{},"sourceType":"module"}